<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OneDay</title>
    <style>
        h1, h2 {text-align: center; color: #78aeed}
        table {max-width: 40%; height: 60%; border: lightgrey; margin: auto; font-size: 25px}
        body {background: #242424; font-family: Calibri; font-size: 20vm}
        th {color: aquamarine; background: #363636; padding: 4px;  max-height: 8vh; max-width: 5vw;}
        td {color: white; background: #363636; padding: 6px;}
        button {display: inline-block; border: 0; background: #363636; color: white; height: 40px; width: 80px; border-radius: 10px}
        button:hover{ background: #3e3e3e }
    </style>
</head>
    <body>
    <div>
        <div>
            <h1 id="day">Today is undefined</h1>
        </div>
        <div>
            <h2 id="week">of the week</h2>
        </div>

    
<div style="text-align: center;" id="dayFrame">
    <button id="yesterday" style="display: inline-block; justify-content: left">
        Yersterday
    </button>
    <table id="allday" style="display: inline-block; justify-content: center">
        <tr>
            <th style="border-top-left-radius: 10px">Time</th>
            <th style="border-top-right-radius: 10px">Lessons</th>
        </tr>
        <tr>
            <th>8:00-<br/>9:50</th>
            <td id="08:00:00"></td>
        </tr>
        <tr>
            <th>9:50-<br/>11:25</th>
            <td id="09:50:00"></td>
        </tr>
        <tr>
            <th>12:10-<br/>13:45</th>
            <td id="12:10:00"></td>
        </tr>
        <tr>
            <th style="border-bottom-left-radius: 10px">14:00-<br/>15:35</th>
            <td id="14:00:00" style="border-bottom-right-radius: 10px"></td>
        </tr>
    </table>
    <button id="tomorrow" style="display: inline-block">
        Tomorrow
    </button>
</div>
    </div>
    <div style="text-align: center; padding-top: 10px">
        <button style="height: 80px; width: 100px; border-radius: 10px" onclick="location.href ='./' ">Menu</button>
    </div>
    <script>
            document.getElementById("tomorrow").addEventListener("click", () => {
               const params = getQueryParams(location.href);
               const dayOffset = params['day'];
               location.href = `today?day=${Number(dayOffset) + 1}`;
            });
            
            document.getElementById("yesterday").addEventListener("click", () => {
                const params = getQueryParams(location.href);
                const dayOffset = params['day'];
                location.href = `today?day=${Number(dayOffset) - 1}`;
            })
            
            const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
            
            async function GetDay(){
                const params = getQueryParams(location.href);
                const dayOffset = params['day'];
                
                const response = await fetch(`/today/api/${dayOffset}`, {
                    method: "GET",
                    headers: {"Accept" : "application/json"}
                });
                
                if (response.ok === true){
                    const day = await response.json();
                    SetDay(day);
                }
            }
            function getQueryParams(url) {
                const paramArr = url.slice(url.indexOf('?') + 1).split('&');
                const params = {};
                paramArr.map(param => {
                    const [key, val] = param.split('=');
                    params[key] = decodeURIComponent(val);
                })
                return params;
            }
            
            function SetDay(day){
                if (day.weekday === -1) {
                    document.getElementById("day").innerText = "Today is Sunday"
                }
                else{
                    document.getElementById("day").innerText = "Today is " + days[day.weekday - 1];
                }
                let week;
                switch (day.week){
                    case 1:
                        week = "of the first week."
                        break;
                    case 2:
                        week = "of the second week."
                        break;
                }
                document.getElementById("week").innerText = week;
                if (day.weekday === -1){
                    document.getElementById("allday").remove();
                }else{
                    day.subjects.forEach( _ => SetLesson(_))
                }
            }
            
            function SetLesson(lesson){
                const td = document.getElementById(lesson.time.start);
        
                let info = lesson.name + "[" + lesson.type + "]" + "\n"
                
                lesson.audience.forEach(_ => info += _.name + "\n");
                
                lesson.teachers.forEach(_ => info += _.name + "\n");
                
                td.innerText = info;

                switch (lesson.type){
                    case "лаб.":
                        td.style.backgroundColor = "#526D73";
                        break;
                    case "пр.з.":
                        td.style.backgroundColor = "#735252";
                        break;
                    case "лк.":
                        td.style.backgroundColor = "#657352";
                        break;
                }
            }
            GetDay();

        </script>
    </body>
</html>